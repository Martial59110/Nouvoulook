---

const response = await fetch(`${import.meta.env.API_URL}/history`);
const data = await response.json();
const history = {
  imageUrl: data[0]?.imageUrl || '',
  timeLine: data[0]?.timeLine || '',
  textContent: data[0]?.textContent|| '',
  textContent2: data[0]?.textContent2|| '',
  textContent3: data[0]?.textContent3|| '',
};

const apiUrl = import.meta.env.PUBLIC_API_URL || 'http://localhost:3001';

interface TimelineItem {
    id: string;
    year: string;
    description: string;
    icon: string;
    color: string;
}

const responseTimelineItems = await fetch(`${import.meta.env.API_URL}/timeline-item`);
const timelineItems: TimelineItem[] = await responseTimelineItems.json();

// Tri des items par année
const sortedTimelineItems = timelineItems.sort((a, b) => parseInt(a.year) - parseInt(b.year));

// Couleurs et icônes par défaut (utilisées si non définies dans la base de données)
const defaultColors = ['#E23E57', '#FC4811', '#E09C2B'];
const defaultIcons = ['bi-star-fill', 'bi-heart-fill', 'bi-people-fill', 'bi-lightbulb-fill', 'bi-award-fill'];
---

<div class="timeline-container-nouveau">
    <h2 class="timeline-title-nouveau">Historique</h2>
    <div class="timeline-nouveau">
        {sortedTimelineItems.map((item, idx) => {
            const isEven = idx % 2 === 0;
            const color = item.color || defaultColors[idx % defaultColors.length];
            const icon = item.icon || defaultIcons[idx % defaultIcons.length];
            return (
                <div class={`timeline-item-nouveau ${isEven ? 'left' : 'right'} animate__animated ${isEven ? 'animate__fadeInLeft' : 'animate__fadeInRight'} fade-in-scroll`}>
                    <div class="timeline-badge-nouveau" style={`background:${color};`}>
                        <i class={`bi ${icon}`}></i>
                    </div>
                    <div class="timeline-dot-center" style={`border-color:${color};`} />
                    <div class="timeline-bubble-nouveau" style={`border-color:${color};`}>
                        <div class="timeline-year-nouveau" style={`color:${color};`}>{item.year}</div>
                        <div class="timeline-description-nouveau">{item.description}</div>
                    </div>
                </div>
            );
        })}
        <div class="timeline-vertical-line-nouveau"></div>
    </div>
</div>

<style>
.timeline-container-nouveau {
    padding: 4rem 2rem;
    max-width: 1200px;
    margin: 0 auto;
    position: relative;
}
.timeline-title-nouveau {
    display: flex;
    align-items: center;
    gap: 1.1rem;
    font-family: 'Montserrat', 'Segoe UI', Arial, sans-serif;
    font-size: clamp(2.7rem, 7vw, 4.2rem);
    font-weight: 200;
    letter-spacing: 0.04em;
    background: linear-gradient(90deg, #E23E57 0%, #FC4811 60%, #E09C2B 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    text-fill-color: transparent;
    margin: clamp(30px, 5vh, 50px) 0 clamp(2rem, 5vh, 4rem);
    padding-bottom: 0.7rem;
    border: none;
    position: relative;
}
.timeline-title-nouveau::after {
    content: '';
    display: block;
    position: absolute;
    left: 0.5rem;
    bottom: 0;
    width: 120px;
    height: 6px;
    border-radius: 3px;
    background: linear-gradient(90deg, #E23E57 0%, #FC4811 60%, #E09C2B 100%);
    opacity: 0.7;
}
.timeline-title-nouveau .timeline-title-icon {
    font-size: 2.2rem;
    color: #E23E57;
    background: #fff;
    border-radius: 50%;
    box-shadow: 0 2px 8px 0 #e23e5740;
    padding: 0.18em 0.32em 0.18em 0.32em;
    display: flex;
    align-items: center;
    justify-content: center;
}
.timeline-nouveau {
    position: relative;
    padding: 2rem 0;
}
.timeline-vertical-line-nouveau {
    content: '';
    position: absolute;
    left: 50%;
    top: 0;
    width: 6px;
    height: 100%;
    background: linear-gradient(180deg, #E23E57 0%, #FC4811 50%, #E09C2B 100%);
    border-radius: 3px;
    opacity: 0.18;
    z-index: 0;
    transform: translateX(-50%);
}
.timeline-item-nouveau {
    display: flex;
    align-items: center;
    justify-content: flex-start;
    margin-bottom: 3.5rem;
    position: relative;
    min-height: 120px;
    z-index: 1;
}
.timeline-item-nouveau.left {
    flex-direction: row;
}
.timeline-item-nouveau.right {
    flex-direction: row-reverse;
}
.timeline-badge-nouveau {
    width: 54px;
    height: 54px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2rem;
    color: #fff;
    box-shadow: 0 2px 12px 0 rgba(233,30,99,0.10);
    border: 4px solid #fff;
    z-index: 2;
    position: relative;
}
.timeline-dot-center {
    position: absolute;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background: #fff;
    border: 4px solid #E23E57;
    box-shadow: 0 2px 8px 0 rgba(233,30,99,0.10);
    z-index: 3;
    transition: background 0.3s, box-shadow 0.3s, border-color 0.3s;
    pointer-events: none;
}
.timeline-item-nouveau.right .timeline-dot-center,
.timeline-item-nouveau.left .timeline-dot-center {
    /* Toujours centré */
}
.timeline-item-nouveau:hover .timeline-dot-center {
    background: var(--dot-color, #E23E57);
    box-shadow: 0 0 0 8px rgba(233,30,99,0.13);
    border-color: var(--dot-color, #E23E57);
}
.timeline-item-nouveau:nth-child(1):hover .timeline-dot-center {
    --dot-color: #E23E57;
}
.timeline-item-nouveau:nth-child(2):hover .timeline-dot-center {
    --dot-color: #FC4811;
}
.timeline-item-nouveau:nth-child(3):hover .timeline-dot-center {
    --dot-color: #E09C2B;
}
.timeline-item-nouveau:nth-child(4):hover .timeline-dot-center {
    --dot-color: #E23E57;
}
.timeline-item-nouveau:nth-child(5):hover .timeline-dot-center {
    --dot-color: #FC4811;
}
.timeline-bubble-nouveau {
    background: #fff;
    border-radius: 1.2rem;
    box-shadow: 0 4px 16px 0 rgba(233,30,99,0.07);
    padding: 1.5rem 2rem;
    margin: 0 1.5rem;
    min-width: 260px;
    max-width: 420px;
    border: 2.5px solid;
    border-left-width: 8px;
    border-right-width: 8px;
    border-top: none;
    border-bottom: none;
    transition: box-shadow 0.3s, border-color 0.3s, transform 0.3s cubic-bezier(.4,1.5,.5,1), z-index 0.3s;
    position: relative;
    z-index: 1;
}
.timeline-item-nouveau.left .timeline-bubble-nouveau {
    margin-left: 1.5rem;
    border-left-width: 8px;
    border-right-width: 2.5px;
}
.timeline-item-nouveau.right .timeline-bubble-nouveau {
    margin-right: 1.5rem;
    border-right-width: 8px;
    border-left-width: 2.5px;
}
.timeline-item-nouveau:hover .timeline-bubble-nouveau {
    box-shadow: 0 8px 32px 0 #e87c3d20, 0 2px 8px #0001;
    transform: scale(1.06) translateY(-8px);
    z-index: 2;
}
.timeline-year-nouveau {
    font-size: 1.3rem;
    font-weight: 700;
    margin-bottom: 0.7rem;
    letter-spacing: 1px;
}
.timeline-description-nouveau {
    color: #4a4a4a;
    line-height: 1.7;
    font-size: 1.08rem;
}
@media (max-width: 900px) {
    .timeline-bubble-nouveau {
        padding: 1.1rem 1rem;
        min-width: 0;
        max-width: 98vw;
    }
    .timeline-badge-nouveau {
        width: 40px;
        height: 40px;
        font-size: 1.3rem;
    }
    .timeline-dot-center {
        width: 22px;
        height: 22px;
        border-width: 3px;
    }
}
@media (max-width: 700px) {
    .timeline-nouveau {
        padding: 0.5rem 0;
    }
    .timeline-item-nouveau {
        flex-direction: column !important;
        align-items: center;
        margin-bottom: 2.2rem;
        width: 100%;
    }
    .timeline-badge-nouveau {
        margin-bottom: 0.5rem;
        margin-left: 0;
        align-self: center;
        position: relative;
        left: 0;
        width: 38px;
        height: 38px;
        font-size: 1.2rem;
        z-index: 2;
    }
    .timeline-dot-center {
        display: none;
    }
    .timeline-bubble-nouveau {
        margin: 0;
        width: 100%;
        border-radius: 0.8rem;
        padding: 1rem 0.7rem;
        min-width: 0;
        max-width: 100vw;
        border-width: 2.5px !important;
        border-left-width: 2.5px !important;
        border-right-width: 2.5px !important;
    }
    .timeline-vertical-line-nouveau {
        left: 50%;
        width: 2px;
        opacity: 0.10;
        background: linear-gradient(180deg, #E23E57 0%, #FC4811 50%, #E09C2B 100%);
        z-index: 0;
        transform: translateX(-50%);
        height: 100%;
    }
    .timeline-year-nouveau {
        text-align: center;
        font-size: 1.1rem;
    }
    .timeline-description-nouveau {
        text-align: center;
        font-size: 1rem;
    }
    .timeline-item-nouveau.left, .timeline-item-nouveau.right {
        flex-direction: column !important;
        align-items: center;
    }
}
.fade-in-scroll {
    opacity: 0;
    transform: translateY(20px);
    transition: opacity 0.6s ease, transform 0.6s ease;
}
.fade-in-scroll.visible {
    opacity: 1;
    transform: translateY(0);
}
</style>

<script is:inline>
document.addEventListener('DOMContentLoaded', () => {
  const els = document.querySelectorAll('.fade-in-scroll');
  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.classList.add('visible');
        observer.unobserve(entry.target);
      }
    });
  }, { threshold: 0.2 });
  els.forEach(el => observer.observe(el));
});
</script>

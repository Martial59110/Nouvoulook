---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import '../style/benevolat.css';

const response = await fetch(`${import.meta.env.API_URL}/boutique`);
const data = await response.json();

console.log('Boutique data:', data);

const boutique = data[0] || {
  imageUrl: '/assets/concept1.png',
  sections: [],
  flyerPdfUrl: ''
};

console.log('Boutique processed:', boutique);
console.log('Sections count:', boutique.sections?.length || 0);

const apiUrl = import.meta.env.PUBLIC_API_URL || 'http://localhost:3001';

// R√©cup√©rer les informations du PDF si il existe
let pdfInfo = null;
if (boutique.flyerPdfUrl) {
  try {
    const pdfResponse = await fetch(`${import.meta.env.API_URL}/pdf-documents`);
    const pdfDocuments = await pdfResponse.json();
    pdfInfo = pdfDocuments.find((pdf: any) => pdf.url === boutique.flyerPdfUrl);
  } catch (error) {
    console.error('Erreur lors de la r√©cup√©ration des informations PDF:', error);
  }
}
---

<Layout 
  title="Nouvoulook - Notre concept"
  description="D√©couvrez le concept de Nouvoulook : une boutique solidaire qui allie √©cologie, solidarit√© et inclusion √† Marcq-en-Baroeul."
  ogImage="/assets/logo-nouvoulook.png"
  canonical="https://nouvoulook.fr/concept"
>
  <Header />
  <script type="application/ld+json" is:inline>{JSON.stringify({
    '@context': 'https://schema.org',
    '@type': 'Organization',
    'name': 'Nouvoulook',
    'url': 'https://nouvoulook.fr/',
    'logo': 'https://nouvoulook.fr/assets/logo-nouvoulook.png',
    'description': "D√©couvrez le concept de Nouvoulook : une boutique solidaire qui allie √©cologie, solidarit√© et inclusion √† Marcq-en-Baroeul.",
    'address': {
      '@type': 'PostalAddress',
      'addressLocality': 'Marcq-en-Baroeul',
      'addressCountry': 'FR'
    }
  })}</script>
  <main class="container-fluid py-5 dons-main-with-wave position-relative p-5">
    <div class="dons-bg-wave">
      <svg viewBox="0 0 1440 220" fill="none" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="none">
        <path fill="#cfff7a" fill-opacity="1" d="M0,160 C360,2040 1080,80 1440,160 L1440,0 L0,0 Z"></path>
      </svg>
    </div>
    <div class="row justify-content-center align-items-center gy-4 mb-4 position-relative dons-hero-row">
      <div class="col-md-6 position-relative">
        <div class="dons-yellow-box green-box dons-overlap p-4">
          <h1 class="mb-0 benevolat-purple-title concept-green-title">Notre concept</h2>
        </div>
      </div>
      <div class="col-md-6 text-center position-relative">
        {boutique.imageUrl && (
          <img
            src={`${apiUrl}${boutique.imageUrl}`}
            alt="Notre concept"
            class="img-fluid rounded dons-img-real mx-auto mb-2"
            id="concept-img"
          />
        )}
      </div>
    </div>
   
    <!-- Sections dynamiques -->
    {boutique.sections && boutique.sections.length > 0 ? (
      <div>
      
        {boutique.sections.map((section: any, index: number) => (
          <div>
            <section class={`concept-section concept-section-${section.color}`}>
              <div class="concept-section-inner">
                <h2 class={`concept-title concept-title-${section.color}`}>
                  <span class="concept-title-ico">{section.icon || 'üìù'}</span>
                  {section.title}
                </h2>
                <div set:html={section.content} class="section-content"></div>
              </div>
            </section>
            
            {(section.image1 || section.image2) && (
              <div class="concept-img-banner-row">
                {section.image1 && (
                  <div class="concept-img-banner-wrapper">
                    <img src={`${apiUrl}${section.image1}`} alt="Notre concept" class="concept-img-banner" />
                  </div>
                )}
                {section.image2 && (
                  <div class="concept-img-banner-wrapper">
                    <img src={`${apiUrl}${section.image2}`} alt="Notre concept" class="concept-img-banner" />
                  </div>
                )}
              </div>
            )}
            
            {index < boutique.sections.length - 1 && <div class="concept-separator"></div>}
          </div>
        ))}
      </div>
    ) : (
      // Contenu par d√©faut si aucune section n'est configur√©e
      <>
        <section class="concept-section concept-section-green">
          <div class="concept-section-inner">
            <h2 class="concept-title concept-title-green"><span class="concept-title-ico">ü§ù</span>Notre boutique : un lieu solidaire, vivant et ouvert</h2>
            <p class="lead concept-lead">Un espace pour tous, sans distinction <span class="concept-badge concept-badge-green">Ouvert √† tous</span></p>
            <p>
              Chez Nouvoulook, tout le monde a sa place. Pas de guichet r√©serv√©, pas de regard diff√©rent selon votre situation. Ici, vous √™tes un client, un acteur, un membre d'une communaut√©.<br>
              C'est cette √©galit√© de traitement, ce non-jugement fondamental, qui fait la force et la singularit√© de notre boutique.
            </p>
          </div>
        </section>
        <div class="concept-separator"></div>
        <section class="concept-section concept-section-yellow">
          <div class="concept-section-inner">
            <h3 class="concept-title concept-title-yellow"><span class="concept-title-ico">üí°</span> Acheter autrement : donner du sens √† ses achats</h3>
            <p>
              En achetant chez Nouvoulook, vous participez √† un mod√®le qui allie √©cologie, solidarit√© et inclusion. Les v√™tements sont soigneusement tri√©s, rang√©s par taille et genre, toujours dans le respect des personnes.<br>
              Ce n'est pas un d√©p√¥t-vente, c'est un lieu o√π l'objet reprend vie avec dignit√©.
            </p>
          </div>
        </section>
      </>
    )}



    <!-- Contenu statique apr√®s les sections -->
    <div class="reduc-section">
      <div class="reduc-inner">
        <h3 class="reduc-title">
          <span class="reduc-ico">üìù</span>
          Devenir client de notre boutique
        </h3>
        <p class="reduc-desc">
          Pour devenir client de notre boutique solidaire, t√©l√©chargez et remplissez notre fiche d'adh√©sion. 
          C'est simple, rapide et gratuit !
        </p>
        {boutique.flyerPdfUrl ? (
          <div class="text-center mt-3">
            <a href={`${apiUrl}${boutique.flyerPdfUrl}`} target="_blank" class="btn btn-success btn-lg">
              <i class="bi bi-download me-2"></i>
              {pdfInfo ? `T√©l√©charger ${pdfInfo.name}` : 'T√©l√©charger la fiche d\'adh√©sion'}
            </a>
          </div>
        ) : (
          <div class="text-center mt-3">
            <div class="alert alert-warning">
              <i class="bi bi-exclamation-triangle me-2"></i>
              Aucun formulaire d'adh√©sion configur√©. Veuillez uploader un PDF dans l'admin.
            </div>
          </div>
        )}
      </div>
    </div>

    <div class="reduc-section">
      <div class="reduc-inner">
        <h3 class="reduc-title">
          <span class="reduc-ico">üéÅ</span>
          R√©duction r√©serv√©e aux Marcquois
        </h3>
        <p class="reduc-desc">
          Pour les habitants de Marcq-en-Baroeul, une r√©duction sp√©ciale est appliqu√©e sur pr√©sentation d'une attestation CAF. 
          Cette r√©duction permet √† chacun d'acc√©der √† des produits de qualit√© √† prix encore plus solidaire.
        </p>
      </div>
    </div>

    <div class="valeurs-section">
      <div class="valeurs-inner">
        <h3 class="valeurs-title">
          <span class="valeurs-ico">üíö</span>
          Nos valeurs
        </h3>
        <div class="valeurs-row">
          <div class="valeur-card">
            <div class="valeur-icone">ü§ù</div>
            <div class="valeur-titre">D√©veloppement de la mixit√© sociale</div>
          </div>
          <div class="valeur-card">
            <div class="valeur-icone">ü§ó</div>
            <div class="valeur-titre">Respect de la dignit√©</div>
          </div>
          <div class="valeur-card">
            <div class="valeur-icone">üåà</div>
            <div class="valeur-titre">Respect de la diff√©rence</div>
          </div>
          <div class="valeur-card">
            <div class="valeur-icone">‚ôªÔ∏è</div>
            <div class="valeur-titre">D√©veloppement durable</div>
          </div>
        </div>
      </div>
    </div>
  </main>
</Layout>

<script is:inline>
  document.addEventListener('DOMContentLoaded', () => {
    const img = document.getElementById('concept-img'); // Cible l'image principale de la boutique
    if (img) {
      img.addEventListener('load', () => {
        img.classList.add('loaded');
      });
     
      // Au cas o√π l'image serait d√©j√† charg√©e (cache)
      if (img.complete) {
        img.classList.add('loaded');
      }
    }

    // Si tu as d'autres √©l√©ments avec .fade-in-scroll sur cette page, tu peux garder/adapter cette partie :
    // const els = document.querySelectorAll('.fade-in-scroll');
    // const observer = new window.IntersectionObserver((entries) => {
    //   entries.forEach(entry => {
    //     if (entry.isIntersecting) {
    //       entry.target.classList.add('visible');
    //       observer.unobserve(entry.target);
    //     }
    //   });
    // }, { threshold: 0.2 });
    // els.forEach(el => observer.observe(el));
  });
</script>

<style>
body, .concept-bg {
  background: #f8faf7 !important;
}
.concept-bg {
  padding-bottom: 2rem;
}
.concept-section {
  margin: 0 auto 2.5rem auto;
  border-radius: 2rem;
  box-shadow: 0 4px 32px #0001;
  max-width: 1100px;
  padding: 0;
  background: #fff;
  position: relative;
}
.concept-section-green {
  background: linear-gradient(90deg, #e8ffe0 0%, #f8faf7 100%);
}
.concept-section-yellow {
  background: linear-gradient(90deg, #fffbe0 0%, #f8faf7 100%);
}
.concept-section-pink {
  background: linear-gradient(90deg, #ffe0f0 0%, #f8faf7 100%);
}
.concept-section-blue {
  background: linear-gradient(90deg, #e0f0ff 0%, #f8faf7 100%);
}
.concept-section-purple {
  background: linear-gradient(90deg, #f0e0ff 0%, #f8faf7 100%);
}
.concept-section-orange {
  background: linear-gradient(90deg, #ffe8d0 0%, #f8faf7 100%);
}
.concept-section-red {
  background: linear-gradient(90deg, #ffe0e0 0%, #f8faf7 100%);
}
.concept-section-teal {
  background: linear-gradient(90deg, #e0f8f0 0%, #f8faf7 100%);
}
.concept-section-indigo {
  background: linear-gradient(90deg, #e8e0ff 0%, #f8faf7 100%);
}
.concept-section-gray {
  background: linear-gradient(90deg, #f0f0f0 0%, #f8faf7 100%);
}
.concept-section-white {
  background: #fff;
}
.concept-section-black {
  background: linear-gradient(90deg, #e0e0e0 0%, #f8faf7 100%);
}
.concept-section-inner {
  padding: 2.5rem 2.2rem 2.2rem 2.2rem;
}
.concept-title {
  font-size: 2.2rem;
  font-weight: 700;
  margin-bottom: 1.2rem;
  display: flex;
  align-items: center;
  gap: 0.7rem;
  line-height: 1.1;
}
.concept-title-ico {
  font-size: 2.2rem;
  vertical-align: middle;
}
.concept-title-green {
  color: #005009;
  background: linear-gradient(90deg, #cfff7a33 0%, #fff 100%);
  border-radius: 1.2rem;
  padding: 0.2em 0.7em;
  display: inline-flex;
}
.concept-title-yellow {
  color: #a4da47;
  background: linear-gradient(90deg, #fffbe0 0%, #fff 100%);
  border-radius: 1.2rem;
  padding: 0.2em 0.7em;
  display: inline-flex;
}
.concept-title-pink {
  color: #d52151;
  background: linear-gradient(90deg, #ffe0f0 0%, #fff 100%);
  border-radius: 1.2rem;
  padding: 0.2em 0.7em;
  display: inline-flex;
}
.concept-title-blue {
  color: #1e40af;
  background: linear-gradient(90deg, #e0f0ff 0%, #fff 100%);
  border-radius: 1.2rem;
  padding: 0.2em 0.7em;
  display: inline-flex;
}
.concept-title-purple {
  color: #7c3aed;
  background: linear-gradient(90deg, #f0e0ff 0%, #fff 100%);
  border-radius: 1.2rem;
  padding: 0.2em 0.7em;
  display: inline-flex;
}
.concept-title-orange {
  color: #ea580c;
  background: linear-gradient(90deg, #ffe8d0 0%, #fff 100%);
  border-radius: 1.2rem;
  padding: 0.2em 0.7em;
  display: inline-flex;
}
.concept-title-red {
  color: #dc2626;
  background: linear-gradient(90deg, #ffe0e0 0%, #fff 100%);
  border-radius: 1.2rem;
  padding: 0.2em 0.7em;
  display: inline-flex;
}
.concept-title-teal {
  color: #0f766e;
  background: linear-gradient(90deg, #e0f8f0 0%, #fff 100%);
  border-radius: 1.2rem;
  padding: 0.2em 0.7em;
  display: inline-flex;
}
.concept-title-indigo {
  color: #3730a3;
  background: linear-gradient(90deg, #e8e0ff 0%, #fff 100%);
  border-radius: 1.2rem;
  padding: 0.2em 0.7em;
  display: inline-flex;
}
.concept-title-gray {
  color: #374151;
  background: linear-gradient(90deg, #f0f0f0 0%, #fff 100%);
  border-radius: 1.2rem;
  padding: 0.2em 0.7em;
  display: inline-flex;
}
.concept-title-black {
  color: #111827;
  background: linear-gradient(90deg, #e0e0e0 0%, #fff 100%);
  border-radius: 1.2rem;
  padding: 0.2em 0.7em;
  display: inline-flex;
}
.concept-lead {
  font-size: 1.25rem;
  color: #333;
  margin-bottom: 1.2rem;
}

.section-content {
  line-height: 1.6;
}

.section-content p {
  margin-bottom: 1rem;
}

.section-content ul, .section-content ol {
  margin-left: 1.5rem;
  margin-bottom: 1rem;
}

.section-content li {
  margin-bottom: 0.5rem;
}
.concept-badge {
  display: inline-block;
  font-size: 1rem;
  font-weight: 600;
  border-radius: 1.2rem;
  padding: 0.2em 1em;
  margin-left: 1em;
  vertical-align: middle;
}
.concept-badge-green {
  background: #cfff7a;
  color: #005009;
}
.concept-list {
  margin: 1.2rem 0 1.2rem 1.2rem;
  padding-left: 1.2rem;
  font-size: 1.1rem;
}
.concept-separator {
  width: 100%;
  height: 32px;
  background: linear-gradient(90deg, #e8ffe0 0%, #fffbe0 50%, #ffe0f0 100%);
  opacity: 0.25;
  margin: 0 auto 2.5rem auto;
  border-radius: 2rem;
  max-width: 900px;
}
.concept-img-float-left, .concept-img-float-right, .concept-img-animated {
  float: none;
  display: block;
  margin: 1.5rem 2.2rem 1.5rem 0;
  width: 340px;
  max-width: 95vw;
  height: auto;
  border-radius: 1.2rem;
  box-shadow: 0 4px 24px #0002;
  transition: transform 0.3s cubic-bezier(.4,0,.2,1), box-shadow 0.3s;
}
.concept-img-float-right {
  margin: 1.5rem 0 1.5rem 2.2rem;
}
.concept-img-animated:hover {
  transform: scale(1.04) rotate(-1deg);
  box-shadow: 0 8px 32px #a4da4740;
}
@media (max-width: 900px) {
  .concept-section-inner {
    padding: 1.2rem 0.5rem 1.2rem 0.5rem;
  }
  .concept-title {
    font-size: 1.3rem;
    padding: 0.1em 0.3em;
  }
  .concept-img-float-left, .concept-img-float-right, .concept-img-animated {
    float: none;
    display: block;
    margin: 1.2rem auto;
    width: 95vw;
    max-width: 95vw;
    height: auto;
  }
}
.concept-green-title {
  color: #005009 !important;

}
.green-box {
  background-color: #a4da47;
}
.concept-img-float {
  max-width: 220px;
  width: 100%;
  min-width: 120px;
  border-radius: 1.2rem;
  box-shadow: 0 2px 12px #0002;
  margin: 0 2rem 1rem 0;
  float: left;
  shape-outside: border-box;
}
.img-float-right.concept-img-float {
  float: right;
  margin: 0 0 1rem 2rem;
}
@media (max-width: 900px) {
  .concept-img-float, .img-float-right.concept-img-float {
    float: none;
    display: block;
    margin: 1.5rem auto;
    width: 98vw;
    max-width: 98vw;
    min-width: 0;
  }
}
.concept-img-center-wrapper {
  display: flex;
  justify-content: center;
  margin: 2.5rem 0 2.5rem 0;
}
.concept-img-center {
  max-width: 420px;
  width: 100%;
  border-radius: 1.2rem;
  box-shadow: 0 2px 16px #0002;
}
.concept-feature {
  display: flex;
  align-items: center;
  justify-content: center;
  background: #fff;
  border-radius: 1.5rem;
  box-shadow: 0 4px 32px #0001;
  margin: 2.5rem 0;
  padding: 2.2rem 2rem;
  gap: 2.5rem;
}
.concept-feature-left {
  flex-direction: row;
}
.concept-feature-right {
  flex-direction: row-reverse;
}
.concept-feature-center {
  flex-direction: column;
}
.concept-feature-img-wrapper {
  flex: 0 0 320px;
  max-width: 320px;
  display: flex;
  align-items: center;
  justify-content: center;
}
.concept-feature-img {
  width: 100%;
  max-width: 320px;
  border-radius: 1.2rem;
  box-shadow: 0 2px 12px #0002;
  object-fit: cover;
}
.concept-feature-img-center {
  margin-bottom: 1.5rem;
}
.concept-feature-img-large {
  max-width: 420px;
}
.concept-feature-text {
  flex: 1 1 0%;
  min-width: 0;
}
.concept-feature-text-center {
  text-align: center;
}
@media (max-width: 900px) {
  .concept-feature {
    flex-direction: column !important;
    padding: 1.2rem 0.5rem;
    gap: 1.2rem;
  }
  .concept-feature-img-wrapper {
    max-width: 98vw;
    width: 100%;
  }
  .concept-feature-img, .concept-feature-img-large {
    max-width: 98vw;
    width: 100%;
  }
  .concept-feature-text, .concept-feature-text-center {
    text-align: left;
    width: 100%;
  }
}
.concept-img-float-left {
  float: left;
  width: 180px;
  max-width: 40vw;
  margin: 0 1.5rem 1rem 0;
  border-radius: 1rem;
  box-shadow: 0 2px 8px #0001;
}
.concept-img-float-right {
  float: right;
  width: 180px;
  max-width: 40vw;
  margin: 0 0 1rem 1.5rem;
  border-radius: 1rem;
  box-shadow: 0 2px 8px #0001;
}
@media (max-width: 900px) {
  .concept-img-float-left, .concept-img-float-right {
    float: none;
    display: block;
    margin: 1.2rem auto;
    width: 98vw;
    max-width: 98vw;
  }
}
.concept-img-banner-row {
  display: flex;
  justify-content: center;
  align-items: flex-start;
  gap: 2.5rem;
  margin: 2.5rem 0 2.5rem 0;
  flex-wrap: wrap;
}
.concept-img-banner-wrapper {
  display: flex;
  flex-direction: column;
  align-items: center;
  margin: 0;
}
.concept-img-banner {
  width: 100%;
  max-width: 520px;
  max-height: 320px;
  aspect-ratio: 16/9;
  object-fit: cover;
  border-radius: 2rem;
  box-shadow: 0 8px 32px #0002;
  background: #fff;
  padding: 0.7rem;
  transition: transform 0.3s cubic-bezier(.4,0,.2,1), box-shadow 0.3s;
}
.concept-img-banner:hover {
  transform: scale(1.025) rotate(-1deg);
  box-shadow: 0 16px 48px #a4da4740;
}
.concept-img-caption {
  text-align: center;
  color: #888;
  font-size: 1rem;
  margin-top: 0.5rem;
  font-style: italic;
}
@media (max-width: 1100px) {
  .concept-img-banner-row {
    gap: 1.2rem;
  }
}
@media (max-width: 900px) {
  .concept-img-banner-row {
    flex-direction: column;
    gap: 1.2rem;
    margin: 1.2rem 0 1.2rem 0;
  }
}
.reduc-section {
  background: linear-gradient(90deg, #e8ffe0 0%, #f8faf7 100%);
  border-radius: 2rem;
  box-shadow: 0 4px 32px #a4da4740;
  max-width: 900px;
  margin: 3.5rem auto 2.5rem auto;
  padding: 2.5rem 2.2rem 2.2rem 2.2rem;
  display: flex;
  justify-content: center;
}
.reduc-inner {
  width: 100%;
}
.reduc-title {
  font-size: 2.1rem;
  font-weight: 700;
  color: #a4da47;
  display: flex;
  align-items: center;
  gap: 0.7rem;
  margin-bottom: 1.2rem;
}
.reduc-ico {
  font-size: 2.2rem;
  vertical-align: middle;
}
.reduc-desc {
  font-size: 1.18rem;
  color: #222;
  margin-bottom: 0;
}
.valeurs-section {
  background: #fff;
  border-radius: 2rem;
  box-shadow: 0 4px 32px #0001;
  max-width: 1100px;
  margin: 3.5rem auto 1rem auto;
  padding: 2.5rem 2.2rem 2.2rem 2.2rem;
}
.valeurs-inner {
  width: 100%;
}
.valeurs-title {
  font-size: 2rem;
  font-weight: 700;
  color: #005009;
  display: flex;
  align-items: center;
  gap: 0.7rem;
  margin-bottom: 2.2rem;
}
.valeurs-ico {
  font-size: 2.2rem;
  vertical-align: middle;
}
.valeurs-row {
  display: flex;
  justify-content: center;
  align-items: stretch;
  gap: 2.5rem;
  flex-wrap: wrap;
}
.valeur-card {
  background: linear-gradient(135deg, #f8faf7 60%, #e8ffe0 100%);
  border-radius: 1.2rem;
  box-shadow: 0 2px 12px #a4da4740;
  padding: 2.2rem 1.2rem 1.2rem 1.2rem;
  min-width: 180px;
  max-width: 220px;
  flex: 1 1 180px;
  display: flex;
  flex-direction: column;
  align-items: center;
  transition: transform 0.2s, box-shadow 0.2s;
}
.valeur-card:hover {
  transform: translateY(-8px) scale(1.04);
  box-shadow: 0 8px 32px #a4da4740;
}
.valeur-icone {
  background: #cfff7a;
  border-radius: 50%;
  width: 64px;
  height: 64px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 2.5rem;
  margin-bottom: 1.2rem;
  box-shadow: 0 2px 8px #a4da4740;
  transition: background 0.2s;
}
.valeur-card:hover .valeur-icone {
  background: #a4da47;
}
.valeur-titre {
  color: #005009;
  font-size: 1.1rem;
  font-weight: 600;
  text-align: center;
}
@media (max-width: 900px) {
  .reduc-section, .valeurs-section {
    padding: 1.2rem 0.5rem 1.2rem 0.5rem;
  }
  .valeurs-row {
    gap: 1.2rem;
  }
}
</style>

